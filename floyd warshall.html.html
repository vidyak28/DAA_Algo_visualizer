<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floyd-Warshall Algorithm Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 50%, #16213e 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Glass Card Effect */
        .glass {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Code Highlighting */
        .code-keyword {
            color: #c792ea;
        }

        .code-function {
            color: #82aaff;
        }

        .code-variable {
            color: #f78c6c;
        }

        .code-operator {
            color: #89ddff;
        }

        .code-number {
            color: #f78c6c;
        }

        .code-comment {
            color: #546e7a;
            font-style: italic;
        }

        .line-active {
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.3) 0%, transparent 100%);
            border-left: 3px solid var(--primary);
        }

        /* Matrix Cells */
        .matrix-cell {
            width: 56px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .matrix-cell.header {
            background: rgba(99, 102, 241, 0.2);
            font-weight: 600;
            color: var(--primary-light);
        }

        .matrix-cell.infinity {
            color: #64748b;
        }

        .matrix-cell.checking {
            background: rgba(99, 102, 241, 0.4);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
            z-index: 10;
        }

        .matrix-cell.path-ik {
            background: rgba(236, 72, 153, 0.3);
        }

        .matrix-cell.path-kj {
            background: rgba(245, 158, 11, 0.3);
        }

        .matrix-cell.updated {
            background: rgba(34, 197, 94, 0.4);
            animation: cellPulse 0.5s ease-out;
        }

        @keyframes cellPulse {
            0% {
                transform: scale(1.15);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Graph Nodes */
        .graph-node {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            position: absolute;
            background: linear-gradient(145deg, #3730a3 0%, #4f46e5 100%);
            border: 3px solid var(--primary-light);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            z-index: 10;
            transition: all 0.3s ease;
        }

        .graph-node.node-k {
            border-color: var(--warning);
            box-shadow: 0 0 25px rgba(245, 158, 11, 0.6);
        }

        .graph-node.node-i {
            border-color: #ec4899;
            box-shadow: 0 0 25px rgba(236, 72, 153, 0.6);
        }

        .graph-node.node-j {
            border-color: var(--success);
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.6);
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
        }

        .btn-secondary {
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(99, 102, 241, 0.3);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .tooltip:hover::after {
            opacity: 1;
        }
    </style>
</head>

<body class="min-h-screen">

    <!-- Header -->
    <header class="glass border-b border-white/10 px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div>
                <h1
                    class="text-2xl font-bold bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                    Floyd-Warshall Algorithm
                </h1>
                <p class="text-sm text-slate-400 mt-1">All-Pairs Shortest Path ‚Ä¢ Dynamic Programming</p>
            </div>
            <div class="flex items-center gap-4">
                <div class="glass rounded-lg px-4 py-2 flex items-center gap-3">
                    <div class="text-center">
                        <div class="text-xs text-slate-400">Time</div>
                        <div class="font-mono text-indigo-400 font-semibold">O(V¬≥)</div>
                    </div>
                    <div class="w-px h-8 bg-white/10"></div>
                    <div class="text-center">
                        <div class="text-xs text-slate-400">Space</div>
                        <div class="font-mono text-indigo-400 font-semibold">O(V¬≤)</div>
                    </div>
                </div>
                <div class="glass rounded-lg px-4 py-2">
                    <div class="text-xs text-slate-400">Step</div>
                    <div id="stepCounter" class="font-mono text-xl text-purple-400 font-bold">0</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto p-6 grid grid-cols-12 gap-6" style="height: calc(100vh - 100px);">

        <!-- Left Panel: Controls & Code -->
        <aside class="col-span-4 flex flex-col gap-4 overflow-hidden">

            <!-- Controls -->
            <div class="glass rounded-xl p-4">
                <h3 class="text-sm font-semibold text-slate-300 uppercase tracking-wider mb-4">Controls</h3>

                <div class="mb-4">
                    <label class="text-xs text-slate-400 mb-1 block">Graph Preset</label>
                    <select id="graphSelect"
                        class="w-full bg-slate-800/50 border border-white/10 rounded-lg px-3 py-2 text-white focus:border-indigo-500 focus:outline-none">
                        <option value="4">4 Vertices - Simple</option>
                        <option value="5">5 Vertices - Medium</option>
                        <option value="6">6 Vertices - Complex</option>
                    </select>
                </div>

                <div class="grid grid-cols-4 gap-2 mb-4">
                    <button id="btnStart"
                        class="col-span-2 btn-primary text-white py-2.5 rounded-lg font-semibold flex items-center justify-center gap-2">
                        <span id="btnIcon">‚ñ∂</span>
                        <span id="btnText">Start</span>
                    </button>
                    <button id="btnStep" class="btn-secondary text-indigo-400 py-2.5 rounded-lg font-medium tooltip"
                        data-tip="Step Forward">
                        ‚è≠
                    </button>
                    <button id="btnReset"
                        class="bg-rose-500/20 border border-rose-500/30 text-rose-400 py-2.5 rounded-lg font-medium tooltip"
                        data-tip="Reset">
                        ‚Ü∫
                    </button>
                </div>

                <div class="flex items-center gap-3">
                    <span class="text-xs text-slate-400 w-12">Speed</span>
                    <input type="range" id="speedSlider" min="100" max="1500" value="500"
                        class="flex-1 accent-indigo-500">
                    <span id="speedValue" class="font-mono text-xs text-slate-400 w-14 text-right">500ms</span>
                </div>
            </div>

            <!-- Current State -->
            <div class="glass rounded-xl p-4">
                <h3 class="text-sm font-semibold text-slate-300 uppercase tracking-wider mb-3">Current Iteration</h3>
                <div class="grid grid-cols-3 gap-3">
                    <div class="bg-amber-500/10 border border-amber-500/20 rounded-lg p-3 text-center">
                        <div class="text-xs text-amber-400 mb-1">k (via)</div>
                        <div id="stateK" class="font-mono text-2xl font-bold text-amber-300">-</div>
                    </div>
                    <div class="bg-pink-500/10 border border-pink-500/20 rounded-lg p-3 text-center">
                        <div class="text-xs text-pink-400 mb-1">i (from)</div>
                        <div id="stateI" class="font-mono text-2xl font-bold text-pink-300">-</div>
                    </div>
                    <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-lg p-3 text-center">
                        <div class="text-xs text-emerald-400 mb-1">j (to)</div>
                        <div id="stateJ" class="font-mono text-2xl font-bold text-emerald-300">-</div>
                    </div>
                </div>
            </div>

            <!-- Pseudocode -->
            <div class="glass rounded-xl p-4 flex-1 overflow-auto">
                <h3 class="text-sm font-semibold text-slate-300 uppercase tracking-wider mb-3">Pseudocode</h3>
                <div id="codeContainer" class="font-mono text-xs space-y-0.5"></div>
            </div>

            <!-- Legend -->
            <div class="glass rounded-xl p-4">
                <h3 class="text-sm font-semibold text-slate-300 uppercase tracking-wider mb-3">Legend</h3>
                <div class="grid grid-cols-2 gap-2 text-xs">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-indigo-500/40"></div>
                        <span class="text-slate-400">Checking cell</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-pink-500/30"></div>
                        <span class="text-slate-400">dist[i][k]</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-amber-500/30"></div>
                        <span class="text-slate-400">dist[k][j]</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-emerald-500/40"></div>
                        <span class="text-slate-400">Updated</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Right Panel: Visualizations -->
        <section class="col-span-8 flex flex-col gap-4">

            <div class="flex-1 grid grid-cols-2 gap-4">
                <!-- Distance Matrix -->
                <div class="glass rounded-xl p-5 overflow-auto">
                    <h3 class="text-sm font-semibold text-slate-300 uppercase tracking-wider mb-4">Distance Matrix</h3>
                    <div id="matrixContainer" class="inline-block"></div>
                </div>

                <!-- Graph -->
                <div class="glass rounded-xl p-5">
                    <h3 class="text-sm font-semibold text-slate-300 uppercase tracking-wider mb-4">Graph Visualization
                    </h3>
                    <div id="graphContainer" class="relative w-full h-64">
                        <svg id="graphEdges" class="absolute inset-0 w-full h-full overflow-visible"></svg>
                        <div id="graphNodes"></div>
                    </div>
                </div>
            </div>

            <!-- Explanation -->
            <div id="explanationBox" class="glass rounded-xl p-5 border-l-4 border-indigo-500">
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center flex-shrink-0">
                        <span class="text-lg">üí°</span>
                    </div>
                    <div>
                        <h4 id="explTitle" class="font-semibold text-indigo-400">Ready to Start</h4>
                        <p id="explText" class="text-sm text-slate-300 mt-1">
                            The Floyd-Warshall algorithm finds shortest paths between all pairs of vertices.
                            Select a graph and click Start to begin visualization.
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        /**
         * Floyd-Warshall Algorithm Visualizer
         * A comprehensive, educational visualization tool
         */
        (function () {
            'use strict';

            // ================== CONFIGURATION ==================
            const CONFIG = {
                INF: Infinity,
                GRAPHS: {
                    4: [
                        [0, 3, Infinity, 7],
                        [8, 0, 2, Infinity],
                        [5, Infinity, 0, 1],
                        [2, Infinity, Infinity, 0]
                    ],
                    5: [
                        [0, 4, Infinity, Infinity, Infinity],
                        [Infinity, 0, 1, Infinity, Infinity],
                        [Infinity, Infinity, 0, 2, Infinity],
                        [Infinity, Infinity, Infinity, 0, 3],
                        [2, Infinity, Infinity, Infinity, 0]
                    ],
                    6: [
                        [0, 2, Infinity, 1, Infinity, Infinity],
                        [Infinity, 0, 3, Infinity, Infinity, Infinity],
                        [Infinity, Infinity, 0, Infinity, 1, Infinity],
                        [Infinity, 1, Infinity, 0, 2, Infinity],
                        [Infinity, Infinity, Infinity, Infinity, 0, 4],
                        [Infinity, Infinity, Infinity, Infinity, Infinity, 0]
                    ]
                },
                PSEUDOCODE: [
                    { text: '// Floyd-Warshall Algorithm', indent: 0, isComment: true },
                    { text: '// Finds shortest paths between all pairs', indent: 0, isComment: true },
                    { text: '', indent: 0 },
                    { text: 'function floydWarshall(graph):', indent: 0, lineNum: 1 },
                    { text: '  n ‚Üê number of vertices', indent: 1, lineNum: 2 },
                    { text: '  dist[][] ‚Üê copy of graph[][]', indent: 1, lineNum: 3 },
                    { text: '', indent: 0 },
                    { text: '  // Try each vertex as intermediate', indent: 1, isComment: true },
                    { text: '  for k ‚Üê 0 to n-1 do:', indent: 1, lineNum: 4, highlight: 'loop-k' },
                    { text: '    for i ‚Üê 0 to n-1 do:', indent: 2, lineNum: 5, highlight: 'loop-i' },
                    { text: '      for j ‚Üê 0 to n-1 do:', indent: 3, lineNum: 6, highlight: 'loop-j' },
                    { text: '', indent: 0 },
                    { text: '        // Check if path via k is shorter', indent: 4, isComment: true },
                    { text: '        newDist ‚Üê dist[i][k] + dist[k][j]', indent: 4, lineNum: 7, highlight: 'check' },
                    { text: '        if newDist < dist[i][j]:', indent: 4, lineNum: 8, highlight: 'check' },
                    { text: '          dist[i][j] ‚Üê newDist', indent: 5, lineNum: 9, highlight: 'update' },
                    { text: '', indent: 0 },
                    { text: '  return dist[][]', indent: 1, lineNum: 10 }
                ]
            };

            // ================== STATE ==================
            const state = {
                n: 4,
                dist: [],
                original: [],
                steps: [],
                stepIndex: 0,
                running: false,
                paused: true,
                speed: 500,
                timer: null
            };

            // ================== DOM ELEMENTS ==================
            const DOM = {
                graphSelect: document.getElementById('graphSelect'),
                btnStart: document.getElementById('btnStart'),
                btnStep: document.getElementById('btnStep'),
                btnReset: document.getElementById('btnReset'),
                btnIcon: document.getElementById('btnIcon'),
                btnText: document.getElementById('btnText'),
                speedSlider: document.getElementById('speedSlider'),
                speedValue: document.getElementById('speedValue'),
                stepCounter: document.getElementById('stepCounter'),
                stateK: document.getElementById('stateK'),
                stateI: document.getElementById('stateI'),
                stateJ: document.getElementById('stateJ'),
                codeContainer: document.getElementById('codeContainer'),
                matrixContainer: document.getElementById('matrixContainer'),
                graphNodes: document.getElementById('graphNodes'),
                graphEdges: document.getElementById('graphEdges'),
                explTitle: document.getElementById('explTitle'),
                explText: document.getElementById('explText')
            };

            // ================== INITIALIZATION ==================
            function init() {
                renderPseudocode();
                setupEventListeners();
                reset();
            }

            function setupEventListeners() {
                DOM.graphSelect.addEventListener('change', () => reset());
                DOM.btnStart.addEventListener('click', toggleStartPause);
                DOM.btnStep.addEventListener('click', stepForward);
                DOM.btnReset.addEventListener('click', reset);
                DOM.speedSlider.addEventListener('input', (e) => {
                    state.speed = parseInt(e.target.value);
                    DOM.speedValue.textContent = state.speed + 'ms';
                });
            }

            function renderPseudocode() {
                DOM.codeContainer.innerHTML = CONFIG.PSEUDOCODE.map((line, i) => `
                <div id="code-${i}" class="px-2 py-1 rounded transition-all duration-200" 
                     style="padding-left: ${line.indent * 16 + 8}px">
                    ${highlightSyntax(line.text)}
                </div>
            `).join('');
            }

            function highlightSyntax(code) {
                return code
                    .replace(/\b(function|for|if|return|to)\b/g, '<span class="code-keyword">$1</span>')
                    .replace(/\b(floydWarshall|copy)\b/g, '<span class="code-function">$1</span>')
                    .replace(/\b(dist|graph|n|k|i|j)\b/g, '<span class="code-variable">$1</span>')
                    .replace(/(\d+)/g, '<span class="code-number">$1</span>')
                    .replace(/([=<>+\-])/g, '<span class="code-operator">$1</span>');
            }

            // ================== GRAPH RENDERING ==================
            function renderGraph() {
                const n = state.n;
                DOM.graphNodes.innerHTML = '';
                DOM.graphEdges.innerHTML = '';

                // Calculate node positions in a circle
                const cx = 140, cy = 120, r = 85;
                const positions = [];

                for (let i = 0; i < n; i++) {
                    const angle = (2 * Math.PI * i / n) - Math.PI / 2;
                    positions.push({
                        x: cx + r * Math.cos(angle),
                        y: cy + r * Math.sin(angle)
                    });
                }

                // Draw edges
                const graph = state.original;

                // Add arrow marker definition
                const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                defs.innerHTML = `
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="8" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#6366f1"/>
                </marker>
            `;
                DOM.graphEdges.appendChild(defs);

                for (let i = 0; i < n; i++) {
                    for (let j = 0; j < n; j++) {
                        if (i !== j && graph[i][j] !== CONFIG.INF) {
                            drawEdge(positions[i], positions[j], graph[i][j]);
                        }
                    }
                }

                // Draw nodes
                for (let i = 0; i < n; i++) {
                    const node = document.createElement('div');
                    node.className = 'graph-node';
                    node.id = `node-${i}`;
                    node.textContent = i;
                    node.style.left = (positions[i].x - 22) + 'px';
                    node.style.top = (positions[i].y - 22) + 'px';
                    DOM.graphNodes.appendChild(node);
                }
            }

            function drawEdge(from, to, weight) {
                const dx = to.x - from.x;
                const dy = to.y - from.y;
                const len = Math.sqrt(dx * dx + dy * dy);
                const ux = dx / len, uy = dy / len;

                const x1 = from.x + ux * 24;
                const y1 = from.y + uy * 24;
                const x2 = to.x - ux * 28;
                const y2 = to.y - uy * 28;

                // Edge line
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x1);
                line.setAttribute('y1', y1);
                line.setAttribute('x2', x2);
                line.setAttribute('y2', y2);
                line.setAttribute('stroke', '#6366f1');
                line.setAttribute('stroke-width', '2');
                line.setAttribute('marker-end', 'url(#arrowhead)');
                DOM.graphEdges.appendChild(line);

                // Weight label
                const midX = (x1 + x2) / 2 + uy * 12;
                const midY = (y1 + y2) / 2 - ux * 12;
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', midX);
                text.setAttribute('y', midY);
                text.setAttribute('fill', '#a5b4fc');
                text.setAttribute('font-size', '11');
                text.setAttribute('font-family', 'JetBrains Mono');
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'middle');
                text.textContent = weight;
                DOM.graphEdges.appendChild(text);
            }

            // ================== MATRIX RENDERING ==================
            function renderMatrix() {
                const n = state.n;
                let html = `<div class="grid" style="grid-template-columns: repeat(${n + 1}, 56px);">`;

                // Header row
                html += '<div class="matrix-cell header"></div>';
                for (let j = 0; j < n; j++) {
                    html += `<div class="matrix-cell header">${j}</div>`;
                }

                // Data rows
                for (let i = 0; i < n; i++) {
                    html += `<div class="matrix-cell header">${i}</div>`;
                    for (let j = 0; j < n; j++) {
                        const val = state.dist[i][j];
                        const display = val === CONFIG.INF ? '‚àû' : val;
                        const infClass = val === CONFIG.INF ? 'infinity' : '';
                        html += `<div class="matrix-cell ${infClass}" id="cell-${i}-${j}">${display}</div>`;
                    }
                }

                html += '</div>';
                DOM.matrixContainer.innerHTML = html;
            }

            function updateMatrixCell(i, j, value, className) {
                const cell = document.getElementById(`cell-${i}-${j}`);
                if (cell) {
                    cell.textContent = value === CONFIG.INF ? '‚àû' : value;
                    cell.className = 'matrix-cell ' + (value === CONFIG.INF ? 'infinity ' : '') + className;

                    if (className.includes('updated')) {
                        gsap.fromTo(cell,
                            { scale: 1.2, backgroundColor: 'rgba(34, 197, 94, 0.6)' },
                            { scale: 1, backgroundColor: 'rgba(34, 197, 94, 0.4)', duration: 0.4 }
                        );
                    }
                }
            }

            // ================== ALGORITHM STEPS ==================
            function buildSteps() {
                state.steps = [];
                const n = state.n;

                for (let k = 0; k < n; k++) {
                    state.steps.push({
                        type: 'k-start',
                        k,
                        line: 4,
                        title: `Iteration k = ${k}`,
                        text: `Using vertex ${k} as intermediate. Checking if going through ${k} gives shorter paths.`
                    });

                    for (let i = 0; i < n; i++) {
                        for (let j = 0; j < n; j++) {
                            const distIK = state.dist[i][k];
                            const distKJ = state.dist[k][j];
                            const distIJ = state.dist[i][j];
                            const newDist = distIK + distKJ;

                            state.steps.push({
                                type: 'check',
                                k, i, j,
                                distIK, distKJ, distIJ, newDist,
                                line: 7,
                                title: `Checking path ${i} ‚Üí ${k} ‚Üí ${j}`,
                                text: `dist[${i}][${k}] + dist[${k}][${j}] = ${formatDist(distIK)} + ${formatDist(distKJ)} = ${formatDist(newDist)} vs dist[${i}][${j}] = ${formatDist(distIJ)}`
                            });

                            if (newDist < distIJ) {
                                state.dist[i][j] = newDist;
                                state.steps.push({
                                    type: 'update',
                                    k, i, j,
                                    newDist,
                                    line: 8,
                                    title: `Shorter path found!`,
                                    text: `Updated dist[${i}][${j}] from ${formatDist(distIJ)} to ${newDist}. Path ${i} ‚Üí ${k} ‚Üí ${j} is shorter.`
                                });
                            }
                        }
                    }
                }

                state.steps.push({
                    type: 'complete',
                    line: 10,
                    title: '‚úÖ Algorithm Complete',
                    text: 'All shortest paths have been computed. The distance matrix now contains the shortest distance between every pair of vertices.'
                });

                // Reset dist for replay
                state.dist = state.original.map(row => [...row]);
            }

            function formatDist(d) {
                return d === CONFIG.INF ? '‚àû' : d;
            }

            // ================== EXECUTION ==================
            function stepForward() {
                if (state.steps.length === 0) {
                    buildSteps();
                }

                if (state.stepIndex >= state.steps.length) {
                    finish();
                    return;
                }

                const step = state.steps[state.stepIndex];
                state.stepIndex++;
                DOM.stepCounter.textContent = state.stepIndex;

                // Clear previous highlights
                clearHighlights();

                // Highlight code line
                highlightCodeLine(step.line);

                // Update explanation
                updateExplanation(step.title, step.text);

                // Process step type
                switch (step.type) {
                    case 'k-start':
                        DOM.stateK.textContent = step.k;
                        DOM.stateI.textContent = '-';
                        DOM.stateJ.textContent = '-';
                        highlightNode(step.k, 'node-k');
                        break;

                    case 'check':
                        DOM.stateK.textContent = step.k;
                        DOM.stateI.textContent = step.i;
                        DOM.stateJ.textContent = step.j;

                        highlightNode(step.k, 'node-k');
                        highlightNode(step.i, 'node-i');
                        highlightNode(step.j, 'node-j');

                        const cellIJ = document.getElementById(`cell-${step.i}-${step.j}`);
                        const cellIK = document.getElementById(`cell-${step.i}-${step.k}`);
                        const cellKJ = document.getElementById(`cell-${step.k}-${step.j}`);

                        if (cellIJ) cellIJ.classList.add('checking');
                        if (cellIK) cellIK.classList.add('path-ik');
                        if (cellKJ) cellKJ.classList.add('path-kj');
                        break;

                    case 'update':
                        state.dist[step.i][step.j] = step.newDist;
                        updateMatrixCell(step.i, step.j, step.newDist, 'updated');

                        highlightNode(step.k, 'node-k');
                        highlightNode(step.i, 'node-i');
                        highlightNode(step.j, 'node-j');
                        break;

                    case 'complete':
                        finish();
                        return;
                }

                if (state.stepIndex >= state.steps.length) {
                    finish();
                }
            }

            function clearHighlights() {
                document.querySelectorAll('.matrix-cell.checking, .matrix-cell.path-ik, .matrix-cell.path-kj').forEach(el => {
                    el.classList.remove('checking', 'path-ik', 'path-kj');
                });
                document.querySelectorAll('.graph-node').forEach(el => {
                    el.classList.remove('node-k', 'node-i', 'node-j');
                });
                document.querySelectorAll('.line-active').forEach(el => {
                    el.classList.remove('line-active');
                });
            }

            function highlightCodeLine(lineNum) {
                const line = document.getElementById(`code-${lineNum}`);
                if (line) {
                    line.classList.add('line-active');
                    line.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            function highlightNode(id, className) {
                const node = document.getElementById(`node-${id}`);
                if (node) {
                    node.classList.add(className);
                    gsap.fromTo(node, { scale: 1.1 }, { scale: 1, duration: 0.3 });
                }
            }

            function updateExplanation(title, text) {
                DOM.explTitle.textContent = title;
                DOM.explText.textContent = text;
                gsap.fromTo('#explanationBox', { x: -10, opacity: 0.5 }, { x: 0, opacity: 1, duration: 0.3 });
            }

            // ================== CONTROL FUNCTIONS ==================
            function toggleStartPause() {
                if (state.steps.length === 0) {
                    buildSteps();
                }

                if (state.running && !state.paused) {
                    pause();
                } else {
                    start();
                }
            }

            function start() {
                state.running = true;
                state.paused = false;
                DOM.btnIcon.textContent = '‚è∏';
                DOM.btnText.textContent = 'Pause';
                DOM.btnStart.classList.remove('btn-primary');
                DOM.btnStart.classList.add('bg-amber-500');
                runLoop();
            }

            function pause() {
                state.paused = true;
                clearTimeout(state.timer);
                DOM.btnIcon.textContent = '‚ñ∂';
                DOM.btnText.textContent = 'Resume';
                DOM.btnStart.classList.remove('bg-amber-500');
                DOM.btnStart.classList.add('btn-primary');
            }

            function runLoop() {
                if (state.paused) return;
                stepForward();
                if (state.stepIndex < state.steps.length && !state.paused) {
                    state.timer = setTimeout(runLoop, state.speed);
                }
            }

            function finish() {
                state.running = false;
                state.paused = true;
                clearTimeout(state.timer);

                DOM.btnIcon.textContent = '‚ñ∂';
                DOM.btnText.textContent = 'Start';
                DOM.btnStart.classList.remove('bg-amber-500');
                DOM.btnStart.classList.add('btn-primary');

                updateExplanation('‚úÖ Algorithm Complete',
                    'All shortest paths have been computed. The distance matrix now shows the shortest distance between every pair of vertices.');
            }

            function reset() {
                clearTimeout(state.timer);

                state.n = parseInt(DOM.graphSelect.value);
                state.original = CONFIG.GRAPHS[state.n].map(row => [...row]);
                state.dist = state.original.map(row => [...row]);
                state.steps = [];
                state.stepIndex = 0;
                state.running = false;
                state.paused = true;

                DOM.stepCounter.textContent = '0';
                DOM.stateK.textContent = '-';
                DOM.stateI.textContent = '-';
                DOM.stateJ.textContent = '-';

                DOM.btnIcon.textContent = '‚ñ∂';
                DOM.btnText.textContent = 'Start';
                DOM.btnStart.classList.remove('bg-amber-500');
                DOM.btnStart.classList.add('btn-primary');

                clearHighlights();
                renderGraph();
                renderMatrix();

                updateExplanation('Ready to Start',
                    'The Floyd-Warshall algorithm finds shortest paths between all pairs of vertices. Click Start to begin or Step to advance manually.');
            }

            // ================== START ==================
            init();
        })();
    </script>
</body>

</html>